openapi: 3.0.1

info:
  title: GoetheForum API
  description: API for the GoetheForum application.
  version: 1.0.0

servers:
  - url: 'http://localhost:3000'
    description: Local server

tags:
  - name: Account
    description: Account related operations (Children&colon; Account Settings)
  - name: Account Settings
    description: Account settings related operations
  - name: User
    description: User related operations

paths:
  # Register
  /account/register:
    post:
      tags:
        - Account
      description: Register a new account.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  minLength: 5
                  maxLength: 250
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 8
              required:
                - username
                - email
                - password
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
                  email:
                    type: string
                    format: email
                  user_id:
                    type: integer
                    format: int64
                  account_id:
                    type: integer
                    format: int64
                  access_token:
                    type: string
                    format: jwt
                  refresh_token:
                    type: string
                    format: jwt
                  user:
                    $ref: '#/components/schemas/User'
                required:
                  - email
                  - access_token
                  - account_id
                  - refresh_token
                  - user
                  - user_id
                  - username
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'
  # Login
  /account/login:
    post:
      tags:
        - Account
      summary: Log in
      description: >
        Log in to an account.
        When mfa is enabled, the user must complete multiple steps to log in.
        After the first step, the user receives a token that must be used in the next step.
        The token contains the previous verification steps, as some verification methods are considered equivalent to others (e.g. backup codes and totp).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              allOf:
                - type: object
                  properties:
                    verification_type:
                      $ref: '#/components/schemas/VerificationType'
                  required:
                    - verification_type
                - oneOf:
                    # Username
                    - type: object
                      title: Username with password
                      properties:
                        username:
                          type: string
                          example: user123
                        verification_type:
                          type: string
                          enum: [ password ]
                          example: password
                        password:
                          type: string
                          example: secret_password
                      required:
                        - username
                        - verification_type
                        - password
                    - type: object
                      title: Username with TOTP
                      properties:
                        username:
                          type: string
                          example: user123
                        verification_type:
                          type: string
                          enum: [ totp ]
                          example: totp
                        totp:
                          type: string
                          pattern: '^[0-9]{6}$'
                          example: 123456
                      required:
                        - username
                        - verification_type
                        - totp
                    - type: object
                      title: Username with backup code
                      properties:
                        username:
                          type: string
                          example: user123
                        verification_type:
                          type: string
                          enum: [ backup_code ]
                          example: backup_code
                        backup_code:
                          type: string
                          pattern: '^[a-zA-Z0-9]{16}$'
                          example: abcdef1234567890
                      required:
                        - username
                        - verification_type
                        - backup_code
                    - type: object
                      title: Username with email code
                      properties:
                        username:
                          type: string
                          example: user123
                        verification_type:
                          type: string
                          enum: [ email ]
                          example: email
                        email_code:
                          type: string
                          pattern: '^[a-zA-Z0-9]{6}$'
                          example: 123456
                      required:
                        - username
                        - verification_type
                        - email_code
                    # Email
                    - type: object
                      title: Email with password
                      properties:
                        email:
                          type: string
                          format: email
                          example: user@example.com
                        verification_type:
                          type: string
                          enum: [ password ]
                          example: password
                        password:
                          type: string
                          example: secret_password
                      required:
                        - email
                        - verification_type
                        - password
                    - type: object
                      title: Email with TOTP
                      properties:
                        email:
                          type: string
                          format: email
                          example: user@example.com
                        verification_type:
                          type: string
                          enum: [ totp ]
                          example: totp
                        totp:
                          type: string
                          pattern: '^[0-9]{6}$'
                          example: 123456
                      required:
                        - email
                        - verification_type
                        - totp
                    - type: object
                      title: Email with backup code
                      properties:
                        email:
                          type: string
                          format: email
                          example: user@example.com
                        verification_type:
                          type: string
                          enum: [ backup_code ]
                          example: backup_code
                        backup_code:
                          type: string
                          pattern: '^[a-zA-Z0-9]{16}$'
                          example: abcdef1234567890
                      required:
                        - email
                        - verification_type
                        - backup_code
                    - type: object
                      title: Email with email code
                      properties:
                        email:
                          type: string
                          format: email
                          example: user@example.com
                        verification_type:
                          type: string
                          enum: [ email ]
                          example: email
                        email_code:
                          type: string
                          pattern: '^[a-zA-Z0-9]{6}$'
                          example: 123456
                      required:
                        - email
                        - verification_type
                        - email_code
                    # Token
                    - type: object
                      title: Login token with password
                      description: The login token is used for an intermediate login step (e.g. when the user has 2FA enabled).
                      properties:
                        token:
                          type: string
                          format: jwt
                        verification_type:
                          type: string
                          enum: [ password ]
                          example: password
                        password:
                          type: string
                          example: secret_password
                      required:
                        - token
                        - verification_type
                        - password
                    - type: object
                      title: Login token with TOTP
                      description: The login token is used for an intermediate login step (e.g. when the user has 2FA enabled).
                      properties:
                        token:
                          type: string
                          format: jwt
                        verification_type:
                          type: string
                          enum: [ totp ]
                          example: totp
                        totp:
                          type: string
                          pattern: '^[0-9]{6}$'
                          example: 123456
                      required:
                        - token
                        - verification_type
                        - totp
                    - type: object
                      title: Login token with backup code
                      description: The login token is used for an intermediate login step (e.g. when the user has 2FA enabled).
                      properties:
                        token:
                          type: string
                          format: jwt
                        verification_type:
                          type: string
                          enum: [ backup_code ]
                          example: backup_code
                        backup_code:
                          type: string
                          pattern: '^[a-zA-Z0-9]{16}$'
                          example: abcdef1234567890
                      required:
                        - token
                        - verification_type
                        - backup_code
                    - type: object
                      title: Login token with email code
                      description: The login token is used for an intermediate login step (e.g. when the user has 2FA enabled).
                      properties:
                        token:
                          type: string
                          format: jwt
                        verification_type:
                          type: string
                          enum: [ email ]
                          example: email
                        email_code:
                          type: string
                          pattern: '^[a-zA-Z0-9]{6}$'
                          example: 123456
                      required:
                        - token
                        - verification_type
                        - email_code
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                allOf:
                  - type: object
                    properties:
                      status:
                        type: string
                        enum: [ intermediary, complete ]
                    required:
                      - status
                  - type: object
                    oneOf:
                      - type: object
                        title: Intermediary
                        properties:
                          status:
                            type: string
                            enum: [ intermediary ]
                            example: intermediary
                          previous:
                            type: array
                            description: The verification types that have been used so far.
                            uniqueItems: true
                            items:
                              $ref: '#/components/schemas/VerificationType'
                          next:
                            type: array
                            description: The verification types that can be used next.
                            uniqueItems: true
                            items:
                              $ref: '#/components/schemas/VerificationType'
                          token:
                            type: string
                            format: jwt
                        required:
                          - status
                          - token
                          - next
                          - previous
                      - type: object
                        title: Complete
                        properties:
                          status:
                            type: string
                            enum: [ complete ]
                            example: complete
                          user:
                            $ref: '#/components/schemas/User'
                          access_token:
                            type: string
                            format: jwt
                          refresh_token:
                            type: string
                            format: jwt
                        required:
                          - status
                          - user
                          - refresh_token
                          - access_token
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # Refresh token
  /account/refresh:
    post:
      tags:
        - Account
      security:
        - RefreshToken: [ ]
      summary: Refresh token
      description: Refresh the access token using the refresh token.
      responses:
        '200':
          description: OK'
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                    format: jwt
                  user_id:
                    type: integer
                    format: int64
                required:
                  - access_token
                  - user_id
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # Change password
  /account/settings/change_password:
    post:
      tags:
        - Account Settings
      security:
        - AccessToken: [ ]
      summary: Change password
      description: Change the password of the currently logged in user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                old_password:
                  type: string
                  minLength: 8
                  example: secret_password123
                new_password:
                  type: string
                  minLength: 8
                  example: secret_password456
              required:
                - old_password
                - new_password
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                required:
                  - success
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # Generate TOTP secret
  /account/settings/totp/add/generate:
    post:
      tags:
        - Account Settings
      security:
        - AccessToken: [ ]
      summary: Generate TOTP secret
      description: Generate a new TOTP secret for the currently logged in user and store it temporarily (expires after 5 minutes)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  secret:
                    type: string
                    example: JBSWY3DPEHPK3PXP
                  qr:
                    type: string
                    format: uri
                    example: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAgAElEQVR4nOzdeXxU1f7H8e9
                required:
                  - secret
                  - qr
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # Verify the TOTP secret
  /account/settings/totp/add/verify:
    post:
      tags:
        - Account Settings
      security:
        - AccessToken: [ ]
      summary: Verify TOTP secret
      description: Verify the TOTP secret for the currently logged in user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                  pattern: '^[0-9]{6}$'
                  example: 123456
                password:
                  type: string
                  example: secret_password
              required:
                - token
                - password
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                required:
                  - success
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # Cancel TOTP setup
  /account/settings/totp/add/cancel:
    post:
      tags:
        - Account Settings
      security:
        - AccessToken: [ ]
      summary: Cancel TOTP setup
      description: Cancel the TOTP setup for the currently logged in user.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                required:
                  - success
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # Remove TOTP
  /account/settings/totp/remove:
    post:
      tags:
        - Account Settings
      security:
        - AccessToken: [ ]
      summary: Remove TOTP
      description: Remove the TOTP secret for the currently logged in user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                validation_type:
                  type: string
                  enum: [ totp, backup_code ]
                  example: totp
                token:
                  type: string
                  example: 123456
              required:
                - validation_type
                - token
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                required:
                  - success
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # Get TOTP status
  /account/settings/totp/status:
    get:
      tags:
        - Account Settings
      security:
        - AccessToken: [ ]
      summary: Get TOTP status
      description: Get the TOTP status for the currently logged in user.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  enabled:
                    type: boolean
                    example: true
                required:
                  - enabled
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # Account Info
  /account/info:
    get:
      tags:
        - Account
      security:
        - AccessToken: [ ]
      summary: Get account info
      description: Get the account information of the currently logged in user.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  session:
                    $ref: '#/components/schemas/Session'
                required:
                  - user
                  - session
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # Logout
  /account/logout:
    post:
      tags:
        - Account
      security:
        - AccessToken: [ ]
      summary: Logout
      description: Log out the currently logged in user.
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # User Info
  /user/{user_id}/info:
    get:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Get user info
      description: Get the user information of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    patch:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Update user info
      description: Update the user information of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              # The user info without userId
              type: object
              properties:
                profilePicture:
                  type: string
                  format: base64
                  nullable: true
                bio:
                  type: string
                  nullable: true
                website:
                  type: string
                  format: url
                  nullable: true
                location:
                  type: string
                  nullable: true
                dateOfBirth:
                  type: string
                  format: date
                  nullable: true
                phoneNumber:
                  type: string
                  format: phone
                  nullable: true
                  example: +49 123 456789
                preferredLanguage:
                  type: string
                  example: en
                  nullable: true
                languages:
                  type: array
                  items:
                    type: string
                    example: en
                  example: [ en, de ]
                  nullable: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # User Info profile picture
  /user/{user_id}/info/profile_picture:
    get:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Get user profile picture
      description: Get the profile picture of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: string
                    format: base64
                    nullable: true
                required:
                  - value
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Update user profile picture
      description: Update the profile picture of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                value:
                  type: string
                  format: base64
                  nullable: true
              required:
                - value
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Delete user profile picture
      description: Delete the profile picture of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # User Info bio
  /user/{user_id}/info/bio:
    get:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Get user bio
      description: Get the bio of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: string
                    nullable: true
                required:
                  - value
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Update user bio
      description: Update the bio of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                value:
                  type: string
                  nullable: true
              required:
                - value
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Delete user bio
      description: Delete the bio of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # User Info website
  /user/{user_id}/info/website:
    get:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Get user website
      description: Get the website of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: string
                    maxLength: 255
                    nullable: true
                required:
                  - value
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Update user website
      description: Update the website of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                value:
                  type: string
                  maxLength: 255
                  nullable: true
              required:
                - value
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Delete user website
      description: Delete the website of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # User Info location
  /user/{user_id}/info/location:
    get:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Get user location
      description: Get the location of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: string
                    maxLength: 255
                    nullable: true
                required:
                  - value
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Update user location
      description: Update the location of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                value:
                  type: string
                  maxLength: 255
                  nullable: true
              required:
                - value
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Delete user location
      description: Delete the location of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # User Info date of birth
  /user/{user_id}/info/date_of_birth:
    get:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Get user date of birth
      description: Get the date of birth of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: string
                    format: date
                    nullable: true
                required:
                  - value
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Update user date of birth
      description: Update the date of birth of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                value:
                  type: string
                  format: date
                  nullable: true
              required:
                - value
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Delete user date of birth
      description: Delete the date of birth of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # User Info phone number
  /user/{user_id}/info/phone_number:
    get:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Get user phone number
      description: Get the phone number of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: string
                    maxLength: 15
                    nullable: true
                required:
                  - value
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Update user phone number
      description: Update the phone number of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                value:
                  type: string
                  maxLength: 15
                  nullable: true
              required:
                - value
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Delete user phone number
      description: Delete the phone number of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # User Info preferred language
  /user/{user_id}/info/preferred_language:
    get:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Get user preferred language
      description: Get the preferred language of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: string
                    minLength: 2
                    maxLength: 2
                    nullable: true
                required:
                  - value
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Update user preferred language
      description: Update the preferred language of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                value:
                  type: string
                  minLength: 2
                  maxLength: 2
                  nullable: true
              required:
                - value
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Delete user preferred language
      description: Delete the preferred language of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # User Info languages
  /user/{user_id}/info/languages:
    get:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Get user languages
      description: Get the languages of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: array
                    items:
                      type: string
                      minLength: 2
                      maxLength: 2
                    nullable: true
                required:
                  - value
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Update user languages
      description: Update the languages of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                value:
                  type: array
                  items:
                    type: string
                    minLength: 2
                    maxLength: 2
                  nullable: true
              required:
                - value
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Delete user languages
      description: Delete the languages of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  # User display name
  /user/{user_id}/display_name:
    get:
      tags:
        - User
      summary: Get user display name
      description: Get the display name of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: string
                    maxLength: 255
                required:
                  - value
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags:
        - User
      security:
        - AccessToken: [ ]
      summary: Update user display name
      description: Update the display name of a user.
      parameters:
        - name: user_id
          in: path
          description: The ID of the user.
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                value:
                  type: string
                  maxLength: 255
              required:
                - value
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  #

components:
  schemas:
    ErrorResponse:
      type: object
      description: An error response object. (None of the properties are guaranteed to be present.)
      properties:
        message:
          type: string
        type:
          type: string
        longMessage:
          type: string
        details:
          type: object
    User:
      type: object
      description: A user object. (Username and email may be null if the user is deleted (soft delete, for privacy reasons).)
      properties:
        ID:
          type: integer
          format: int64
        username:
          type: string
          description: Username may be null if the user is deleted.
          nullable: true
        email:
          type: string
          format: email
          description: Email may be null if the user is deleted.
          nullable: true
        role:
          $ref: '#/components/schemas/Role'
        displayName:
          type: string
        avatar:
          type: string
          format: base64
          nullable: true
        createdAt:
          type: string
          format: date-time
        deletedAt:
          type: string
          format: date-time
          nullable: true
        bannedAt:
          type: string
          format: date-time
          nullable: true
      required:
        - ID
        - role
        - displayName
        - createdAt
        - email
        - username
        - bannedAt
        - deletedAt
        - avatar
    UserInfo:
      type: object
      description: A user info object.
      properties:
        userId:
          type: integer
          format: int64
        profilePicture:
          # The profile picture is sent as a buffer object.
          type: string
          format: base64
          nullable: true
        bio:
          type: string
          nullable: true
        website:
          type: string
          format: url
          nullable: true
        location:
          type: string
          nullable: true
        dateOfBirth:
          type: string
          format: date
          nullable: true
        phoneNumber:
          type: string
          format: phone
          nullable: true
          example: +49 123 456789
        preferredLanguage:
          type: string
          example: en
          nullable: true
        languages:
          type: array
          items:
            type: string
            example: en
          example: [ en, de ]
          nullable: true
      required:
        - userId
    Session:
      type: object
      description: A session object. (The token is not included in this object.)
      properties:
        ID:
          type: integer
          format: int64
        userId:
          type: integer
          format: int64
        created:
          type: string
          format: date-time
        expires:
          type: string
          format: date-time
        lastUsed:
          type: string
          format: date-time
      required:
        - ID
        - userId
        - created
        - expires
        - lastUsed
    Role:
      type: string
      enum: [ UNVERIFIED, USER, MODERATOR, ADMIN, OWNER, SYSTEM ]
    VerificationType:
      type: string
      enum: [ password, totp, backup_code, email ]
  securitySchemes:
    AccessToken:
      description: JWT access token. By default, the token is valid for 2 hours. (Can return statuses&colon; 400, 401)
      type: http
      scheme: bearer
      bearerFormat: JWT
    RefreshToken:
      description: JWT refresh token. By default, the token is valid for 4 weeks. (Can return statuses&colon; 400, 401)
      type: http
      scheme: bearer
      bearerFormat: JWT
  responses:
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    BadRequest:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
